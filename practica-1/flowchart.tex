% File              : flowchart.tex
% Author            : David Barcene <david.barcene@utp.ac.pa>
% Date              : 24.02.2026
% Last Modified Date: 24.02.2026
% Last Modified By  : David Barcene <david.barcene@utp.ac.pa>
\documentclass[border=10pt]{standalone}
\usepackage[utf8]{inputenc}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows, positioning, shadows}

\begin{document}

\tikzstyle{startstop} = [rectangle, rounded corners, minimum width=3cm, minimum height=1cm,text centered, draw=black, fill=red!30, font=\bfseries]
\tikzstyle{io} = [trapezium, trapezium left angle=70, trapezium right angle=110, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=blue!20]
\tikzstyle{process} = [rectangle, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=orange!30]
\tikzstyle{decision} = [diamond, aspect=2, minimum width=3cm, minimum height=1cm, text centered, draw=black, fill=green!20]
\tikzstyle{arrow} = [thick,->,>=stealth]

\begin{tikzpicture}[node distance=2cm]

% --- Grupo de run_sbatch.sh ---
\node (start) [startstop] {Inicio: run\_sbatch.sh};
\node (dir) [io, below of=start] {Lectura de /reads/*.fq};
\node (loop) [decision, below of=dir, yshift=-0.5cm] {¿Hay muestras?};
\node (sbatch) [process, right of=loop, xshift=3.5cm] {sbatch sample\_proc.sh};

% --- Grupo de sample_proc.sh ---
\node (bwa) [process, below of=sbatch, yshift=-1cm] {BWA MEM (Alineamiento)};
\node (view) [process, below of=bwa] {Samtools View (SAM $\rightarrow$ BAM)};
\node (sort) [process, below of=view] {Samtools Sort};
\node (index) [process, below of=sort] {Samtools Index};
\node (stats) [process, below of=index] {Samtools Flagstat};
\node (out) [io, below of=stats] {Output: .bam + stats.txt};

% --- Conexiones ---
\draw [arrow] (start) -- (dir);
\draw [arrow] (dir) -- (loop);
\draw [arrow] (loop) -- node[anchor=south] {Sí} (sbatch);
\draw [arrow] (sbatch) -- (bwa);
\draw [arrow] (bwa) -- (view);
\draw [arrow] (view) -- (sort);
\draw [arrow] (sort) -- (index);
\draw [arrow] (index) -- (stats);
\draw [arrow] (stats) -- (out);

% El lazo de vuelta al loop
\draw [arrow] (sbatch.north) |- ([yshift=0.5cm]sbatch.north) -| (loop.north);
\draw [arrow] (loop.west) -- ++(-1,0) |- (start.west) node[anchor=south west, xshift=1.5cm] {No (Fin)};

% Etiquetas de contexto
%\node[draw, dashed, inner sep=1em, fit=(start) (loop), label=above:{\textbf{Orquestador (Loop)}}] {};
%\node[draw, dashed, inner sep=1em, fit=(bwa) (out), label=right:{\textbf{Tarea Slurm (Job)}}] {};

\end{tikzpicture}
\end{document}
